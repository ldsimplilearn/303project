{
   "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "deployment-suffix": {
            "defaultValue": "RandEnt",
            "type": "String",
            "metadata": {
                "description": "Specify the prefix for the resources."
            }
        },
        "deployment-location": {
            "defaultValue": "eastus",
            "type": "String",
            "allowedValues": [
                "eastus",
                "eastus2",
                "westus",
                "westus2",
                "centralus"
            ],
            "metadata": {
                "description": "Specify the location for the resources."
            }
        },
        "adminUsername": {
            "defaultValue": "azureuser",
            "type": "String",
            "metadata": {
                "description": "Specify the administrator user name."
            }
        },
        "adminPassword": {
            "defaultValue": "Password1234",
            "type": "String",
            "metadata": {
                "description": "Specify the administrator user password."
            }
        },
        "deployment-env-tag": {
            "defaultValue": "test",
            "type": "String",
            "metadata": {
                "description": "Specify the environment tag for the resources."
            }
        }
    },
    "variables": {
    },
    "resources": [

        //Deploy data network
        {
            "name": "data-network-template",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "relativePath": "RandEnt-compute-template.json"
                },
                "parameters": {
                    "deployment-suffix": { "value": "[parameters('deployment-suffix')]" },
                    "deployment-location": { "value": "[parameters('deployment-location')]" },
                    "adminUsername": { "value": "[parameters('adminUsername')]" },
                    "adminPassword": { "value": "[parameters('adminPassword')]" },
                    "deployment-env-tag": { "value": "[parameters('deployment-env-tag')]" }
                 }

            }
        },
        //Deploy app network (for testing storage access denial)
        {
            "name": "test-network-template",
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2020-10-01",
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "relativePath": "RandEnt-compute-template.json"
                },
                "parameters": {
                    "deployment-suffix": { "value": "[concat('test',parameters('deployment-suffix'))]" },
                    "deployment-location": { "value": "[parameters('deployment-location')]" },
                    "adminUsername": { "value": "[parameters('adminUsername')]" },
                    "adminPassword": { "value": "[parameters('adminPassword')]" },
                    "deployment-env-tag": { "value": "temp" }
                 }

            }
        }

    ]
}